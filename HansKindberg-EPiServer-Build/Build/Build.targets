<?xml version="1.0" encoding="utf-8"?>
<Project ToolsVersion="4.0" xmlns="http://schemas.microsoft.com/developer/msbuild/2003">
	<Import Project="..\..\Build\Package-Build.targets" />
	<PropertyGroup>
		<BuildDependsOn>
			$(BuildDependsOn);
			DeployPackageContentToPackageDirectory
		</BuildDependsOn>
	</PropertyGroup>
	<PropertyGroup>
		<CreateNuGetPackageDependsOn>
			$(CreateNuGetPackageDependsOn);
			CopyHansKindbergBuildContent
		</CreateNuGetPackageDependsOn>
	</PropertyGroup>
	<Target Name="CollectHansKindbergBuildContent">
		<ItemGroup Condition="@(HansKindbergBuildContent) == ''">
			<HansKindbergBuildContent Include="$(HansKindbergBuildContentDirectory)build\**\*.*" />
		</ItemGroup>
	</Target>
	<PropertyGroup>
		<CopyHansKindbergBuildContentDependsOn>
			CollectHansKindbergBuildContent
		</CopyHansKindbergBuildContentDependsOn>
	</PropertyGroup>
	<Target Name="CopyHansKindbergBuildContent" DependsOnTargets="$(CopyHansKindbergBuildContentDependsOn)">
		<Copy
			DestinationFiles="@(HansKindbergBuildContent->'Build\%(RecursiveDir)%(Filename)%(Extension)')"
			SourceFiles="@(HansKindbergBuildContent)"
		/>
		<Message
			Importance="$(MessageImportance)"
			Text="Copying '%(HansKindbergBuildContent.Identity)' to 'Build\%(HansKindbergBuildContent.RecursiveDir)%(HansKindbergBuildContent.Filename)%(HansKindbergBuildContent.Extension)'."
		/>
	</Target>
	<PropertyGroup>
		<DeployPackageContentToPackageDirectoryDependsOn>
			CollectAssemblyInformation;
			CollectHansKindbergBuildContent
		</DeployPackageContentToPackageDirectoryDependsOn>
	</PropertyGroup>
	<Target Name="DeployPackageContentToPackageDirectory" DependsOnTargets="$(DeployPackageContentToPackageDirectoryDependsOn)">
		<PropertyGroup>
			<_PackageDestinationDirectory Condition="@(_PackageDestinationDirectory) == ''">$(NuGetPackagesDirectory)HansKindberg-EPiServer-Build\</_PackageDestinationDirectory>
		</PropertyGroup>
		<ItemGroup Condition="@(_PackageContent) == ''">
			<_PackageContent Include="build\**\*.*" Exclude="build\Build.props;build\Build.targets" />
			<_PackageContent Include="Configuration\Web.Template.config" />
			<_PackageContent Condition="Exists('$(_PackageDestinationDirectory)build\HansKindberg.Build.XmlTransformation.Tasks.dll')" Remove="build\HansKindberg.Build.XmlTransformation.Tasks.dll" />
			<_PackageContent Condition="Exists('$(_PackageDestinationDirectory)build\Microsoft.Web.XmlTransform.dll')" Remove="build\Microsoft.Web.XmlTransform.dll" />
			<_PackageContent Condition="Exists('$(_PackageDestinationDirectory)build\System.IO.Abstractions.dll')" Remove="build\System.IO.Abstractions.dll" />
		</ItemGroup>
		<Copy
			DestinationFiles="@(_PackageContent->'$(_PackageDestinationDirectory)%(RelativeDir)%(Filename)%(Extension)')"
			SourceFiles="@(_PackageContent)"
		/>
		<Message
			Importance="$(MessageImportance)"
			Text="Copying package content '%(_PackageContent.Identity)' to '$(_PackageDestinationDirectory)%(_PackageContent.RelativeDir)%(_PackageContent.Filename)%(_PackageContent.Extension)'."
		/>
	</Target>
</Project>