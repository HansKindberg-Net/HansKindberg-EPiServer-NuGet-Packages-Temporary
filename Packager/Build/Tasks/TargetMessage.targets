<?xml version="1.0" encoding="utf-8"?>
<Project ToolsVersion="4.0" xmlns="http://schemas.microsoft.com/developer/msbuild/2003">
	<UsingTask
		TaskName="TargetMessage"
		TaskFactory="CodeTaskFactory"
		AssemblyFile="$(MSBuildToolsPath)\Microsoft.Build.Tasks.v4.0.dll"
	>
		<ParameterGroup>
			<TargetName ParameterType="System.String" Required="true" />
			<Text ParameterType="System.String" Required="false" />
			<Importance ParameterType="System.String" Required="false" />
		</ParameterGroup>
		<Task>
			<Code Type="Fragment" Language="cs">
				<![CDATA[
					MessageImportance messageImportance = MessageImportance.Normal;
					
					if(!string.IsNullOrEmpty(this.Importance))
					{
						try
						{
							messageImportance = (MessageImportance)Enum.Parse(typeof(MessageImportance), this.Importance, true);
						}
						catch (ArgumentException)
						{
							throw new FormatException(string.Format("\"{0}\" is an invalid value for the \"Importance\" parameter. Valid values are: High, Normal and Low.", this.Importance));
						}
					}
						
					string messagePrefix = !string.IsNullOrEmpty(this.TargetName) ? "Target '" + this.TargetName + "': " : string.Empty;
						
					this.Log.LogMessage(messageImportance, "{0}", new object[] { messagePrefix + this.Text });
				]]>
			</Code>
		</Task>
	</UsingTask>
</Project>